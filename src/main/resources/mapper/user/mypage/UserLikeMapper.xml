<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.routy.routyback.mapper.user.mypage.UserLikeMapper">

    <!-- 좋아요 목록 조회 -->
    <select id="selectUserLikeProducts"
        resultType="com.routy.routyback.dto.user.mypage.UserLikeResponse">

        SELECT UL.ULNO                             AS likeId,
               P.PRDNO                             AS productId,
               P.PRDNAME                           AS productName,
               P.PRDCOMPANY                        AS productCompany,
               P.PRDPRICE                          AS price,
               P.PRDIMG                            AS imageUrl,
               TO_CHAR(UL.ULREGDATE, 'YYYY-MM-DD') AS regDate
        FROM USER_LIKE UL
                 JOIN PRODUCT P ON UL.PRDNO = P.PRDNO
        WHERE UL.USERNO = (SELECT USERNO FROM USERS WHERE USERID = #{userId})
          AND UL.ULTYPE = #{type}
        ORDER BY UL.ULNO DESC
    </select>

    <!-- 좋아요 추가 -->
    <insert id="insertLike">
        INSERT INTO USER_LIKE (USERNO, PRDNO, ULTYPE, ULREGDATE)
        VALUES ((SELECT USERNO FROM USERS WHERE USERID = #{userId}),
                #{productId},
                #{type},
                SYSDATE)
    </insert>

    <!-- 좋아요 삭제 -->
    <delete id="deleteLike">
        DELETE
        FROM USER_LIKE
        WHERE USERNO = (SELECT USERNO FROM USERS WHERE USERID = #{userId})
          AND PRDNO = #{productId}
          AND ULTYPE = #{type}
    </delete>

    <!-- 좋아요 여부 체크 -->
    <select id="countLike" resultType="int">
        SELECT COUNT(*)
        FROM USER_LIKE
        WHERE USERNO = (SELECT USERNO FROM USERS WHERE USERID = #{userId})
          AND PRDNO = #{productId}
          AND ULTYPE = #{type}
    </select>

</mapper>